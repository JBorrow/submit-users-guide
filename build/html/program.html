<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>mit-submit - Available Software:</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css" integrity="sha256-xOpS+e/dER8z72w+qryCieOGysQI8cELAVt3MHG0phY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/tooltipster.bundle.min.css" integrity="sha256-Qc4lCfqZWYaHF5hgEOFrYzSIX9Rrxk0NPHRac+08QeQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-light.min.css" integrity="sha256-Wa1I4jhSXeWd3N6RhfPlkqr1WlT+zS3Vh2YGCg0129E=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro|Source+Sans+Pro|Source+Serif+Pro|Roboto|Roboto+Mono" rel="stylesheet">
<link href="https://fonts.red-dove.com/iosevka-ss09-regular/webfont.css" rel="stylesheet">

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/sizzle.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" integrity="sha256-G7A4JrJjJlFqP0yamznwPjAApIKPkadeHfyIwiaa9e0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/js/tooltipster.bundle.min.js" integrity="sha256-NOU7KrY2aTI4PxDegqYUIknk9qfxVCS0E4JfE9aMwaA=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'mit-submitv1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
      $(document).data('sizzle', {on_load: []});
    </script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
      <script src="app-data.js"></script>
<link rel="index" title="Index" href="genindex.html" />
<link rel="search" title="Search" href="search.html" />
<link rel="next" title="Running and Batch jobs:" href="running.html" />
<link rel="prev" title="Things that work and things that don’t:" href="working.html" />

</head>
<body class="full-height test">
<noscript>
  <div>
    <div id="noscript-message">JavaScript is not enabled. It is needed for this website to work.</div>
  </div>
</noscript>
<div id="whole-page" class="container-fluid content full-height">
  <div id="header-row" class="row">
    <div id="header-container" class="col-md-12">
      <div id="hdr-left">
        <i class="fa fa-bars menu-toggle"></i>
        
<a href="index.html" class="text-logo">mit-submit mit-submitv1 documentation</a>

      </div>
      <div id="hdr-centre" class="text-center stretch">
        <h3 title="Available Software:">Available Software:</h3>
        <h6>Available Software:</h6>
      </div>
      <div id="hdr-search">
        
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
      </div>

      <div id="hdr-index">
        <a href="genindex.html" class="btn btn-default" title="Go to the index"><i class="fa fa-list"></i></a>
      </div>

      <div id="hdr-source">
        <a href="_sources/program.rst.txt" class="btn btn-default" title="See the source for this page"><i class="fa fa-code"></i></a>
      </div>

      <div id="hdr-right">
        
  
  <div class="prev-next">
    
      <div class="pull-left">
        <a class="btn btn-default prev" href="working.html" title="Previous chapter (Things that work and things that don’t:)"><i class="fa fa-chevron-left mr-1em" aria-hidden="true"></i><span class="btn-text">Things that work and things that don’t:</span></a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default next" href="running.html" title="Next chapter (Running and Batch jobs:)"><span class="btn-text">Running and Batch jobs:</span>&nbsp;<i class="fa fa-chevron-right ml-1em" aria-hidden="true"></i></a>
      </div>
    </div>
  
      </div>
      <div id="alt-hdr-right">

        <a href="working.html"><i class="fa fa-chevron-left mr-8"></i></a>


        <a href="index.html"><i class="fa fa-home mr-8"></i></a>


        <a href="search.html"><i class="fa fa-search mr-8"></i></a>


        <a href="genindex.html"><i class="fa fa-list mr-8"></i></a>


        <a href="running.html"><i class="fa fa-chevron-right"></i></a>

      </div>
    </div>
  </div>

  <div id="content-row" class="row">
    <div id="page-content" class="col-md-12 flex-col">
      <div id="content-container">
        <div id="nav">
          
  <div class="navsidebar">
    <div id="sidebar-search">
      
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
    </div>
      <div class="sidebar-block">
        <div class="sidebar-tocheading">
          <div class="pull-left">
            <h2>Table Of Contents</h2>
          </div>
          <div class="pull-right" title="Hide this sidebar (hover at left edge to bring it back)"><i class="fa fa-chevron-left hidetoc"></i></div>
        </div>
        <div class="sidebar-toc">
      
          <div id="toc-filter" title="Type in here to show only matching topics">
            <input class="form-control" id="toc-filter-query" placeholder="Filter by title ...">
          </div>
      
        
  
    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Users guide to the <em>subMIT</em> login pool:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#introduction">Introduction:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-do-i-need-for-an-account">What do I need for an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#how-to-get-help">How to get help:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#heavy-duty-calculations">Heavy duty calculations:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="starting.html">Getting started:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="starting.html#how-to-get-an-account">How to get an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#login-and-basic-areas">Login and basic areas:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#the-rules-for-an-account">The rules for an account:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="working.html">Things that work and things that don’t:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="working.html#do-this">Do this:</a></li>
<li class="toctree-l2"><a class="reference internal" href="working.html#avoid-doing-this">Avoid doing this:</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#available-software">Available Software:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#native-system">Native system:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cvmfs">CVMFS:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conda">Conda:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#containers">Containers:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jupyterhub">JupyterHub:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running and Batch jobs:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running.html#running-locally">Running locally:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#htcondor-examples">HTCondor examples:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#using-batch-systems-to-run-at-a-given-resource">Using batch systems to run at a given resource:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#condor-example-1">Condor example 1:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#condor-example-2">Condor example 2:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#slurm-examples">Slurm examples:</a></li>
</ul>
</li>
</ul>

  
        </div>
      </div>
  </div>
        </div>
        <div id="content" tabindex="0" class="stretch">
          <div id="mnav">
            
  
    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Users guide to the <em>subMIT</em> login pool:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#introduction">Introduction:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-do-i-need-for-an-account">What do I need for an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#how-to-get-help">How to get help:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#heavy-duty-calculations">Heavy duty calculations:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="starting.html">Getting started:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="starting.html#how-to-get-an-account">How to get an account:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#login-and-basic-areas">Login and basic areas:</a></li>
<li class="toctree-l2"><a class="reference internal" href="starting.html#the-rules-for-an-account">The rules for an account:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="working.html">Things that work and things that don’t:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="working.html#do-this">Do this:</a></li>
<li class="toctree-l2"><a class="reference internal" href="working.html#avoid-doing-this">Avoid doing this:</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#available-software">Available Software:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#native-system">Native system:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cvmfs">CVMFS:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conda">Conda:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#containers">Containers:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jupyterhub">JupyterHub:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running and Batch jobs:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running.html#running-locally">Running locally:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#htcondor-examples">HTCondor examples:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#using-batch-systems-to-run-at-a-given-resource">Using batch systems to run at a given resource:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#condor-example-1">Condor example 1:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#condor-example-2">Condor example 2:</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#slurm-examples">Slurm examples:</a></li>
</ul>
</li>
</ul>

  
          </div>
          <div class="body">
            
  <div class="section" id="available-software">
<h1>Available Software:<a class="headerlink" href="#available-software" title="Permalink to this headline">¶</a></h1>
<p>This section will guide you through the various tools and services that you have access to as soon you connect to submit. This guide should help you set up environments for your applications and allow you the flexibilty to develop your code using modern computing tools.</p>
<div class="section" id="native-system">
<h2>Native system:<a class="headerlink" href="#native-system" title="Permalink to this headline">¶</a></h2>
<p>All of the submit machines come with several tools to help you get started with your work. A few examples are shown below:</p>
<ol class="arabic simple">
<li>Languages:</li>
</ol>
<ul class="simple">
<li>python</li>
<li>c++</li>
<li>Java</li>
</ul>
<ol class="arabic simple" start="2">
<li>Tools:</li>
</ol>
<ul class="simple">
<li>XRootd</li>
<li>GFAL</li>
</ul>
<p>For more complicated workflows, there are several options on how to proceed. Many environments can be set up through CVFMS provided by CERN. If you need more control of the environment, either conda or dockers are commonly used and well supported. For more information see the sections below.</p>
</div>
<div class="section" id="cvmfs">
<h2>CVMFS:<a class="headerlink" href="#cvmfs" title="Permalink to this headline">¶</a></h2>
<p>The CernVM File System (CVMFS) provides a scalable, reliable and low- maintenance software distribution service. It was developed to assist High Energy Physics (HEP) collaborations to deploy software on the worldwide- distributed computing infrastructure used to run data processing applications. CernVM-FS is implemented as a POSIX read-only file system in user space (a FUSE module). Files and directories are hosted on standard web servers and mounted in the universal namespace /cvmfs.</p>
<p>More documentation on CVMFS can be found here:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://cernvm.cern.ch/fs/">CVMFS</a></li>
</ol>
<p>In order to initialize CVMFS on submit machines you can simply use the command below:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /cvmfs/cms.cern.ch/cmsset_default.sh
</pre></div>
</div>
<p>Once CVMFS has been sourced you can see the options in /cvmfs. If you want to use ROOT or any other CMS specific tools you can also download CMSSW releases and work within a CMS environment. A simple example is shown below:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cmsrel CMSSW_10_2_13
<span class="nb">cd</span> CMSSW_10_2_13/src
cmsenv
</pre></div>
</div>
<p>Once the cms environment is set up, ROOT is now available to you as well</p>
</div>
<div class="section" id="conda">
<h2>Conda:<a class="headerlink" href="#conda" title="Permalink to this headline">¶</a></h2>
<p>Conda is an open source package management system and environment management system. We can use this to set up consistent environments and manage the package dependencies for various applications. Below is an example to set up a python3 environment for working with coffea and dask.</p>
<p>### Coffea installation with Miniconda
For installing Miniconda, see also <a class="reference external" href="https://hackmd.io/GkiNxag0TUmHnnCiqdND1Q#Local-or-remote">https://hackmd.io/GkiNxag0TUmHnnCiqdND1Q#Local-or-remote</a></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
<span class="c1"># Run and follow instructions on screen</span>
bash Miniconda3-latest-Linux-x86_64.sh
</pre></div>
</div>
<p>NOTE: always make sure that conda, python, and pip point to local Miniconda installation (<cite>which conda</cite> etc.).</p>
<p>You can either use the default environment`base` or create a new one:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># create new environment with python 3.7, e.g. environment of name `coffea`</span>
conda create --name coffea <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.7
<span class="c1"># activate environment `coffea`</span>
conda activate coffea
</pre></div>
</div>
<p>Install coffea, xrootd, and more. SUEP analysis uses Fastjet with awkward array input (fastjet&gt;=3.3.4.0rc8) and vector:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip install git+https://github.com/CoffeaTeam/coffea.git <span class="c1">#latest published release with `pip install coffea`</span>
conda install -c conda-forge xrootd
conda install -c conda-forge ca-certificates
conda install -c conda-forge ca-policy-lcg
conda install -c conda-forge dask-jobqueue
conda install -c anaconda bokeh
conda install -c conda-forge <span class="s1">&#39;fsspec&gt;=0.3.3&#39;</span>
conda install dask
conda install pytables
pip install --pre fastjet
pip install vector
</pre></div>
</div>
</div>
<div class="section" id="containers">
<h2>Containers:<a class="headerlink" href="#containers" title="Permalink to this headline">¶</a></h2>
<p>Containers are becoming commonplace in scientific workflows. Submit offers access to containers through Singularity images provided through CVMFS. This section will give a short example on how to enter into a singularity container to run your framework. For more information on dockers see the site below:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/build/">docker</a></li>
</ol>
<p>For this example, we will use the coffea-base singularity image based on the following image:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://github.com/CoffeaTeam/docker-coffea-base">coffea-base</a></li>
</ol>
<p>Entering into the singularity environment is easy once you have sourced CVMFS. You can simply do the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>singularity shell -B <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>:/work /cvmfs/unpacked.cern.ch/registry.hub.docker.com/coffeateam/coffea-dask:latest
</pre></div>
</div>
<p>Now you should be in a singularity environment. To test you try to import a non-native package like coffea in python:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3 -c <span class="s2">&quot;import coffea&quot;</span>
</pre></div>
</div>
<p>The command above naturally binds the PWD and work directory. If you need to specify another area to bind you can do the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SINGULARITY_BIND</span><span class="o">=</span><span class="s2">&quot;/mnt&quot;</span>
</pre></div>
</div>
<p>Now you can run in many different environments that are available in singularity images through CVMFS.</p>
</div>
<div class="section" id="jupyterhub">
<h2>JupyterHub:<a class="headerlink" href="#jupyterhub" title="Permalink to this headline">¶</a></h2>
<p>In addition to the tools above, you have access to Jupyter Notebooks through a JupyterHub set up at submit. You can log in below:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://submit00.mit.edu/jupyter">JupyterHub</a></li>
</ol>
<p>This JupyterHub is set up through the submit machines meaning that you have access to all of your data through jupyter notebooks. You will have access to basic python2 and python3 configurations. In additionif you need a more complex environment, you can run your notebooks in any conda environment that you have set up. This allows you to create the exact environement you need for your projects. An example on how to set up a conda environment is shown above.</p>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer-row" class="row">

    <div class="col-md-12">
        <span></span><span class="pull-right">&copy; Copyright 2021, Chad Freer, Christoph Paus.
        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1 and the
        <a href="https://pypi.org/project/sphinx-sizzle-theme/"

           title="0.0.9/821a5457 [2020-04-16T19:31:16]"

        >Sizzle</a> theme.</span>
    </div>

  </div>
</div>

<div id="tooltips" class="hidden">
</div>

<script>
$(document).ready(function() {
  'use strict';
  var $search = $('.search-query');

  var $filter = $('#toc-filter-query');
  var $toclist = $('.sidebar-toc > ul').find('li');

  if ($toclist.length === 0) {
    $toclist = $('.localtoc > ul').find('li');
  }


  var $nav = $('#nav');

  //$('#whole-page').removeClass('hidden');
  var nav_width = $nav.width();


  var search_url = 'search.html';

  function perform_search(e) {
    var $elem;

    if (e.type === 'keypress') {
      $elem = $(e.target);
    }
    else if (e.type === 'click') {
      $elem = $(e.target).parents('.input-group').find('input');
    }
    var q = $elem.val().trim();

    if (q) {
      var url = search_url + '?q=' + q + '&check_keywords=yes&area=default';

      location.href = url;
    }
  }


  function apply_filter() {
    var s = $filter.val().trim().toLowerCase();

    $toclist.find('a').removeClass('hidden');
    $toclist.each(function() {
      var $this = $(this);
      var $link = $this.find('> a');
      var t = $link.text().toLowerCase();
      var show = t.indexOf(s) >= 0;

      if (!show) {
        $link.addClass('hidden');
      }
    });
  }

  $filter.on('keyup', function(e) {
    apply_filter();
  });



  $search.on('keypress', function(e) {
    if (e.which == 13) {
      perform_search(e);
    }
  });
  $search.parents('.input-group').find('.input-group-addon').on('click', perform_search);
  $(document).on('click', '.summary .fa-caret-right', function(e) {
    var $elem = $(e.target).parents('li');
    var $next = $elem.next();
    $elem.addClass('hidden');
    $next.removeClass('hidden');
  });
  $(document).on('click', '.detail .fa-caret-down', function(e) {
    var $elem = $(e.target).parents('li');
    var $prev = $elem.prev();
    $elem.addClass('hidden');
    $prev.removeClass('hidden');
  });

  $('#content').on('click', function() {
    $('#mnav').hide();
  });

  var counter = 0;
  var timer = null;

  function show_nav() {
    $('#content').off('mousemove', track_mouse);
    if (timer !== null) {
      clearTimeout(timer);
      timer = null;
    }
    $nav.show();
  }

  function track_mouse(e) {
    var x = e.clientX;

    if (x < 15) {
      ++counter;
      if (timer === null) {
        timer = setTimeout(show_nav, 2000);
      }
    }
    else {
      counter = 0;
    }
    if (counter >= 20) {
      show_nav();
    }
  };

  function hide_nav() {
    $nav.hide();
    counter = 0;
    $('#content').on('mousemove', track_mouse);
  }

  $('.hidetoc').on('click', hide_nav);

  $(document).on('keyup', function(e) {
    if (e.ctrlKey) {
      if (e.which == 37) {      // Ctrl+left arrow
        hide_nav();
      }
      else if (e.which == 39) { // Ctrl+right arrow
        show_nav();
      }
    }
  });

  $('.menu-toggle').on('click', function(e) {
    $('#mnav').toggle();
  });

  function scroll_nav(frag) {
    var sel = '#nav ' + (frag ? 'a[href="' + frag + '"]' : '.toctree-l1 a.current');

    var $link = $(sel);

    if ($link.length > 0) {
      $link[0].scrollIntoView({block: 'center'});
    }
  }

  // If the navigator is long, then the item we clicked on to get here might
  // not be in view. Try to scroll it into the view - a slight delay is needed
  // to get it to sync properly with other stuff going on (as the page has just
  // loaded). Hence the setTimeout with a timeout of 0.

  function do_scroll() {
    scroll_nav(window.location.hash);
  }

  setTimeout(do_scroll, 0);

  function adjust_size() {
    // we need to set the height explicitly so that scrolling regions in the
    // content area work properly.
    var h = $('#page-content').height();

    $('#nav, #content').height(h);
    if ($('#nav').is(':visible')) {
      $('#mnav').hide();
    }
  }

  adjust_size();

  $(window).on('resize', adjust_size);

  function focus_content() {
    $('#content').focus();  // so that keyboard can be used to scroll, etc.
  }

  setTimeout(focus_content, 150);

  var sizzle = $(document).data('sizzle');

  function make_tooltip(id, h, b) {
    var $e = $('<div>').attr('id', id);
    var $b = $('<div>').addClass('tc-body').html(b);

    if (h) {
      var $h = $('<div>').addClass('tc-heading').html(h);
      $e.append($h);
    }
    $e.append($b);
    return $e;
  }

  var default_tt_options = {
    theme: ['tooltipster-light', 'tooltipster-light-customized'],
    interactive: true,
    maxWidth: 600,
    contentCloning: true
  };

  function activate_tooltips() {
    var $tt = $('.tt');

    //console.log('tt links:', $tt.length);
    $tt.tooltipster(default_tt_options);
  }



  function add_glossary_tooltips() {
    var links = $('a');  // can qualify with .reference.internal
    var glinks = {};
    var pat = /(.*)\.html#(term-.*)$/;
    var found = false;  // links in this document

    $.each(links, function(i, link) {
        var $link = $(link);
        var href = $link.attr('href');
        var m = href.match(pat);

        if (m) {
          var s = m[1].replace(/^(\.\.\/)+/, '');

          if (s === sizzle.app_data.glossary.document) {
            var k = m[2];

            if (k in glinks) {
              glinks[k].push($link);
            }
            else {
              glinks[k] = [$link];
            }
            found = true;
          }
        }
    });
    if (found) {
      var $t = $('#tooltips');
      var data = sizzle.app_data.glossary.terms;

      $.each(glinks, function(k, v) {
        var d = data[k];

        if (d) {  // as a sanity check
          var s = 'tc-'+ k;
          var $e = make_tooltip(s, d.term, d.defn);
          $t.append($e);

          $.each(v, function(i, link) {
            link.addClass('tt').attr('data-tooltip-content', '#' + s);
          });
        }
      });
    }
  }

  if (sizzle.app_data && sizzle.app_data.glossary &&
      sizzle.app_data.glossary.document) {
    add_glossary_tooltips();
  }




  function add_custom_tooltips() {
    var info_tips = sizzle.app_data.custom_data['info-tips'] || {};

    if ($.isEmptyObject(info_tips)) {
      return;
    }

    var tt_options = $.extend({contentAsHTML: true}, default_tt_options);

    $('.tc-info').each(function() {
      var $elem = $(this).prev();
      var classes = $elem.attr('class');
      var m = /\btci-([\S]+)/.exec(classes);

      if (m !== null) {
        var key = m[1];

        if (key in info_tips) {
          var v = info_tips[key];
          var tt = $elem.tooltipster(tt_options).tooltipster('content', v);
        }
      }
    });
  }

  add_custom_tooltips();

  setTimeout(activate_tooltips, 1000);


  // Clipboard copy for code blocks with captions

  $('.code-block-caption').each(function() {
    var $cap = $(this);
    var $btn = $('<span class="clip-copy"><span class="copied hidden">Copied!</span><i class="fa fa-clipboard" title="Copy contents"></i></span>');
    var $code = $cap.parent().find('.highlight');

    $cap.append($btn);
    $btn.find('.fa-clipboard').data('clip-text', $code.text());
  });

  var clipboard = new ClipboardJS('.code-block-caption .fa-clipboard', {
    'text': function(trigger) {
      return $(trigger).data('clip-text');
    }
  });

  clipboard.on('success', function(e) {
    var $copied = $(e.trigger).prev();

    $copied.removeClass('hidden');

    setTimeout(function() {$copied.addClass('hidden'); }, 1000);
  });

  if (sizzle.on_load) {
    sizzle.on_load.forEach(function(f) {
      f();
    });
  }
});
</script>
</body>
</html>